name: Deploy to Kubernetes

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  # ============================================================================
  # LAB
  # ============================================================================
  deploy-lab-gate:
    name: ðŸš¦ 01 Approve (lab)
    runs-on: ubuntu-latest
    environment: lab
    steps:
      - name: Approved
        run: echo "Deployment to lab approved"

  deploy-lab:
    name: ðŸš€ Deploy (lab)
    needs: deploy-lab-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: lab
    secrets: inherit

  # ============================================================================
  # DEV
  # ============================================================================
  deploy-dev-gate:
    name: ðŸš¦ 02 Approve (dev)
    runs-on: ubuntu-latest
    environment: dev
    steps:
      - name: Approved
        run: echo "Deployment to dev approved"

  deploy-dev:
    name: ðŸš€ Deploy (dev)
    needs: deploy-dev-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: dev
    secrets: inherit

  # ============================================================================
  # QS
  # ============================================================================
  deploy-cs-gate:
    name: ðŸš¦ Approve (qs)
    runs-on: ubuntu-latest
    environment: qs
    steps:
      - name: Approved
        run: echo "Deployment to qs approved"

  deploy-qs:
    name: ðŸš€ Deploy (qs)
    needs: deploy-cs-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: qs
    secrets: inherit

  # ============================================================================
  # PROD
  # ============================================================================
  deploy-prod-gate:
    name: ðŸš¦ Approve (prod)
    runs-on: ubuntu-latest
    environment: prod
    steps:
      - name: Approved
        run: echo "Deployment to prod approved"

  deploy-prod:
    name: ðŸš€ Deploy (prod)
    needs: deploy-prod-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: prod
    secrets: inherit
