name: Deploy to Kubernetes

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  # ============================================================================
  # LAB
  # ============================================================================
  deploy-01-lab-gate:
    name: ðŸš¦ LAB Approval Gate
    runs-on: ubuntu-latest
    environment: lab
    steps:
      - name: Approved
        run: echo "Deployment to lab approved"

  deploy-01-lab:
    name: ðŸš€ LAB Deploy
    needs: deploy-01-lab-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: lab
    secrets: inherit

  # ============================================================================
  # DEV
  # ============================================================================
  deploy-02-dev-gate:
    name: ðŸš¦ DEV Approval Gate
    needs: deploy-01-lab-gate
    runs-on: ubuntu-latest
    environment: dev
    steps:
      - name: Approved
        run: echo "Deployment to dev approved"

  deploy-02-dev:
    name: ðŸš€ DEV Deploy
    needs: deploy-02-dev-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: dev
    secrets: inherit

  # ============================================================================
  # QS
  # ============================================================================
  deploy-03-qs-gate:
    name: ðŸš¦ QS Approval Gate
    needs: deploy-02-dev-gate
    runs-on: ubuntu-latest
    environment: qs
    steps:
      - name: Approved
        run: echo "Deployment to qs approved"

  deploy-03-qs:
    name: ðŸš€ QS Deploy
    needs: deploy-03-qs-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: qs
    secrets: inherit

  # ============================================================================
  # PROD
  # ============================================================================
  deploy-04-prod-gate:
    name: ðŸš¦ PROD Approval Gate
    needs: deploy-03-qs-gate
    runs-on: ubuntu-latest
    environment: prod
    steps:
      - name: Approved
        run: echo "Deployment to prod approved"

  deploy-04-prod:
    name: ðŸš€ PROD Deploy
    needs: deploy-04-prod-gate
    uses: ./.github/workflows/deploy-environment.yaml
    with:
      environment: prod
    secrets: inherit
